# ヤマト運輸のスマホで送る伝票作成ツール

このツールは、ヤマト運輸の「スマホで送る」サービスを使って、複数の配送伝票を自動で作成するPythonプログラムです。GUIで簡単に配送先情報を入力でき、Seleniumを使って自動的に伝票を作成し、LINEメッセージでQRコードログイン用のURLを送信します。

## 🌟 主な機能

- **GUI操作**: Tkinterを使った分かりやすいインターフェースで、最大10件の配送先を一度に入力可能
- **自動伝票作成**: Seleniumでヤマト運輸のスマホサイトに自動ログインし、伝票情報を自動入力
- **LINE通知**: 作成した伝票のQRコードログイン用URLをLINEメッセージで自動送信
- **ログ機能**: 処理の詳細をログファイルに記録し、エラー発生時も原因を特定しやすい
- **設定管理**: 認証情報やAPIキーを環境変数で安全に管理

## 📁 ファイル構成

```
yamato-shipping-label-creator/
├── main.py                 # メインプログラム（GUIとSelenium自動化処理）
├── config.py               # 設定ファイル（環境変数の読み込み）
├── logging_config.py       # ログ設定ファイル
├── g_mail_send.py          # Gmail/LINEメッセージ送信機能
├── LineYamatoParser.py     # LINE URL解析機能
├── .env                    # 環境変数ファイル（要作成、Git管理外）
├── logs/                   # ログファイル保存先（自動作成）
└── downloads/              # ダウンロードファイル保存先（自動作成）
```

## 🚀 セットアップ方法

### 1. 必要な環境

- Python 3.7以上
- Google Chrome ブラウザ
- ChromeDriver（Selenium 4.6+ では自動管理されます）

### 2. 必要なライブラリのインストール

```bash
pip install selenium python-dotenv requests
```

### 3. 環境変数の設定

プロジェクトのルートディレクトリに `.env` ファイルを作成し、以下の環境変数を設定してください：

```env
# ヤマト運輸のログイン情報
USER=あなたのヤマト運輸のユーザーID
PASS=あなたのヤマト運輸のパスワード
WELCOME_MESSAGE=起動時のメッセージ

# Gmail送信設定（オプション）
GMAIL_ACCOUNT=your-email@gmail.com
GMAIL_PASSWORD=アプリパスワード
MAIL_TO=送信先メールアドレス

# LINE Messaging API設定（オプション）
LINE_ACCESS_TOKEN=あなたのLINEアクセストークン
LINE_USER_ID=送信先のLINEユーザーID
```

**重要**: `.env` ファイルは `.gitignore` でGit管理から除外されているため、秘密情報を安全に管理できます。

### 4. ChromeDriverの準備

Selenium 4.6以降では、ChromeDriverが自動的にダウンロード・管理されます。古いバージョンを使用する場合は、ChromeDriverを手動でインストールしてください。

## 📖 使い方

### 基本的な使い方

1. プログラムを起動します：
   ```bash
   python main.py
   ```

2. GUIウィンドウが開いたら、以下の情報を入力します：
   - **配送名**: 各配送先の名前（最大10件）
   - **コンパクト**: チェックボックスでサイズを選択（チェック=コンパクトサイズ、未チェック=通常サイズ）

3. 「入力を開始する」ボタンをクリックすると、自動処理が開始されます。

4. 処理が完了すると、各配送先に対してLINEメッセージが送信され、QRコードログイン用のURLが届きます。

### 処理の流れ

1. Chromeブラウザが起動し、ヤマト運輸のスマホサイトにアクセス
2. 自動ログイン
3. 各配送先について以下を自動実行：
   - 通常荷物の選択
   - 発払いの選択
   - 個数（1個）の選択
   - サイズの選択（コンパクト/通常）
   - 品名の入力
   - 荷物扱いの設定（精密機器/ワレモノ）
   - 非制限品確認
   - 発送予定日の設定
   - LINEでリクエスト
   - QRコードログイン用URLの取得
   - LINEメッセージの送信
4. すべての処理が完了すると、完了メッセージが表示されます

## ⚙️ 設定のカスタマイズ

### 発送予定日の変更

`main.py` の148行目付近で、発送予定日を変更できます：

```python
date_select.select_by_index(3)  # 0=今日、1=明日、2=明後日、3=3日後...
```

### モバイルエミュレーションの変更

`main.py` の46行目で、エミュレートするデバイスを変更できます：

```python
mobile_emulation = {"deviceName": "iPhone 12 Pro"}  # 他のデバイス名も指定可能
```

## 📝 ログの確認

処理の詳細は `logs/` ディレクトリ内のログファイルに記録されます。エラーが発生した場合は、ログファイルを確認して原因を特定してください。

## ⚠️ 注意事項

- **認証情報の管理**: `.env` ファイルには秘密情報が含まれます。Gitにコミットしないよう注意してください（`.gitignore` で除外済み）
- **利用規約の遵守**: このツールは自動化ツールです。ヤマト運輸の利用規約を確認し、遵守してください
- **エラー処理**: ネットワークエラーやサイトの構造変更により、処理が失敗する可能性があります。その場合はログを確認してください
- **ChromeDriverの更新**: Chromeブラウザが更新されると、ChromeDriverとの互換性問題が発生する可能性があります

## 🐛 トラブルシューティング

### ChromeDriverのエラー

- Selenium 4.6以降を使用している場合、ChromeDriverは自動管理されます
- 古いバージョンを使用している場合は、Chromeのバージョンに合わせてChromeDriverを更新してください

### ログインに失敗する

- `.env` ファイルの `USER` と `PASS` が正しく設定されているか確認してください
- ヤマト運輸のサイトがメンテナンス中でないか確認してください

### LINEメッセージが送信されない

- `.env` ファイルの `LINE_ACCESS_TOKEN` と `LINE_USER_ID` が正しく設定されているか確認してください
- LINE Messaging APIの設定が正しいか確認してください

## 📚 関連ファイルの説明

### `main.py`
メインプログラム。GUIの構築、Seleniumによる自動化処理、エラーハンドリングを担当します。

### `config.py`
環境変数から認証情報を読み込む設定ファイルです。

### `logging_config.py`
ログの出力形式や保存先を設定するファイルです。

### `g_mail_send.py`
Gmailメール送信とLINEメッセージ送信の機能を提供します。

### `LineYamatoParser.py`
LINE URLから伝票情報を解析し、整形されたメッセージを生成します。

## 🔧 開発者向け情報

### コードの構造

- 変数はファイルの冒頭にまとめて宣言されています
- エラーハンドリングには `traceback` を使用して詳細なエラー情報を表示
- コメントは日本語で「なぜその処理が必要か」まで説明されています

### カスタマイズのヒント

- 新しい機能を追加する場合は、既存のコード構造に合わせて実装してください
- エラーが発生した場合は、`traceback.print_exc()` で詳細なスタックトレースを確認できます
- デバッグ時は、`logs/` ディレクトリのログファイルを確認してください

## 📄 ライセンス

このプロジェクトは個人利用を目的としています。商用利用や再配布の際は、ヤマト運輸の利用規約を確認してください。

## 🤝 サポート

問題が発生した場合は、以下の情報を含めて報告してください：
- エラーメッセージ
- `logs/` ディレクトリのログファイル
- 実行環境（Pythonバージョン、Chromeバージョンなど）

---

**注意**: このツールは自動化ツールです。利用する際は、ヤマト運輸の利用規約を遵守し、適切に使用してください。
